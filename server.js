function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react")),server=require("react-dom/server"),Helmet=_interopDefault(require("react-helmet")),reactRedux=require("react-redux"),history=require("history"),abab=require("abab"),router=require("naglfar"),router__default=_interopDefault(router),redux=require("redux"),thunk=_interopDefault(require("redux-thunk")),logger=_interopDefault(require("redux-logger"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],0<=t.indexOf(r)||(a[r]=e[r]);return a}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,a=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var c,i=e[Symbol.iterator]();!(n=(c=i.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Root=function(e){var t=e.head,r=e.baseStyles,n=e.StyleComponent,a=e.content,o=e.initialState,c=e.jsSource;return React.createElement("html",t.htmlAttributes.toComponent(),React.createElement("head",null,t.title.toComponent(),t.meta.toComponent(),t.link.toComponent(),React.createElement("link",{rel:"apple-touch-icon",sizes:"57x57",href:"/apple-touch-icon-57x57.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"60x60",href:"/apple-touch-icon-60x60.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"72x72",href:"/apple-touch-icon-72x72.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"76x76",href:"/apple-touch-icon-76x76.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"114x114",href:"/apple-touch-icon-114x114.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"120x120",href:"/apple-touch-icon-120x120.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"144x144",href:"/apple-touch-icon-144x144.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"152x152",href:"/apple-touch-icon-152x152.png"}),React.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/apple-touch-icon-180x180.png"}),React.createElement("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),React.createElement("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),React.createElement("meta",{name:"apple-mobile-web-app-title",content:t.title.toString()}),React.createElement("meta",{name:"mobile-web-app-capable",content:"yes"}),React.createElement("meta",{name:"theme-color",content:"#fff"}),React.createElement("meta",{name:"application-name",content:t.title.toString()}),React.createElement("meta",{name:"msapplication-TileColor",content:"#fff"}),React.createElement("meta",{name:"msapplication-TileImage",content:"mstile-144x144.png"}),React.createElement("meta",{name:"msapplication-config",content:"browserconfig.xml"}),React.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/favicon-32x32.png"}),React.createElement("link",{rel:"icon",type:"image/png",sizes:"192x192",href:"/android-chrome-192x192.png"}),React.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/favicon-16x16.png"}),React.createElement("link",{rel:"shortcut icon",href:"/favicon.ico"}),r&&React.createElement("style",{dangerouslySetInnerHTML:{__html:r}}),n&&React.createElement(n,null),o&&React.createElement("meta",{"data-initial-state":o})),React.createElement("body",t.bodyAttributes.toComponent(),React.createElement("div",{id:"root",dangerouslySetInnerHTML:{__html:a}}),t.script.toComponent(),React.createElement("script",{src:"/"+c})))},clientDev="undefined"!=typeof document&&"production"!==process.env.NODE_ENV,toArray=function(e){return Array.isArray(e)?e:[e]},configureStore=function(e){var t=e.reducer,r=e.initialState,n=e.history,a=e.customMiddleware,o=void 0===a?[]:a,c=e.enableLogging,i=[thunk,router__default(n)].concat(_toConsumableArray(toArray(o)),[c&&clientDev&&logger]).filter(Boolean);return redux.applyMiddleware.apply(void 0,_toConsumableArray(i))(redux.createStore).apply(void 0,_toConsumableArray([t,_objectSpread({},r,{location:router.buildLocationState(n.location)}),c&&clientDev&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()].filter(Boolean)))},renderCache={},renderHtml=function(e){var t=e.AppComponent,r=e.store,n=e.baseCss,a=e.jsSource,o=e.StyleComponent,c=server.renderToString(React.createElement(reactRedux.Provider,{store:r},React.createElement(t,null))),i=server.renderToStaticMarkup(React.createElement(Root,{head:Helmet.renderStatic(),baseStyles:n,StyleComponent:o,content:c,initialState:abab.btoa(JSON.stringify(r.getState())),jsSource:a}));return"<!doctype html>\n".concat(i)},resolveRoute=function(e){var a=e.path,t=e.cachePerUrl,o=void 0!==t&&t,c=_objectWithoutProperties(e,["path","cachePerUrl"]);return o&&renderCache[a]?renderCache[a]:router.resolveLocation(a,c.store.dispatch).then(function(e){var t=e.status,r=e.url;if(r)return{status:t,url:r};var n=renderHtml(c);return o&&(renderCache[a]={status:t,body:n}),{status:t,body:n}})},renderRoute=function(e){var n=e.reducer,a=e.cachePerUrl,o=_objectWithoutProperties(e,["reducer","cachePerUrl"]);return function(e){var t=e.url,r=e.initialState;return resolveRoute(_objectSpread({},o,{cachePerUrl:!r&&a,path:t,store:configureStore({reducer:n,initialState:r,history:history.createMemoryHistory({initialEntries:[t]})})}))}},randRange=function(e,t){var r=0<arguments.length&&void 0!==e?e:0,n=1<arguments.length&&void 0!==t?t:100;return Math.floor(Math.random()*(n-r+1)+r)},createSession=function(e){return intToStr(randRange(0,Number.MAX_SAFE_INTEGER))},intToStr=function(e){return e.toString(36)},hashStr=function(e){for(var t=5381,r=52711,n=(e+="").length;n--;){var a=e.charCodeAt(n);t=33*t^a,r=33*r^a}return intToStr(4096*(t>>>0)+(r>>>0))},csrfHash=function(e,t,r){return"".concat(hashStr(e+t)).concat(hashStr(e+r)).concat(hashStr(e+t+r))},isValidCSRF=function(e,t,r){var n=_slicedToArray(r.split("|"),2),a=n[0],o=n[1],c=Date.now()<parseInt(a,36),i=o===csrfHash(e,t,a);return c&&i},validate=function(r){return function(e,t){return t&&e&&isValidCSRF(r,e,t)}},create=function(n,a){return function(e,t){var r=intToStr(Date.now()+a);return{session:e=e||createSession(),csrf:t=t||"".concat(r,"|").concat(csrfHash(n,e,r))}}},csrf=function(e){return{create:create(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:36e5),validate:validate(e)}};exports.csrfCreator=csrf,exports.routeRenderer=renderRoute;
